const colorToggleButton=document.querySelector("#color-toggle-btn .nav-link");const backgroundContainer=document.querySelector("#web_bg");const BACKGROUND_IMAGES={dark:{desktop:"/img/default.png",mobile:"/img/default.png"},light:{desktop:"/img/default1.png",mobile:"/img/default1.png"},fallback:"/img/default.png"};const PAGE_EXCLUSIONS=[];const isExcludedPage=o=>{if(o==="/")return false;return PAGE_EXCLUSIONS.some(e=>o.startsWith(e))};const isMobileViewport=()=>window.innerWidth<768;const removeBannerMask=()=>{const e=document.querySelector("#banner .mask");if(!e)return;e.style.background=`
    linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0.5) 0%,
      rgba(0, 0, 0, 0.35) 60%,
      rgba(0, 0, 0, 0) 100%
    )
  `};const preloadBackgroundImages=()=>{const o=new Set;Object.values(BACKGROUND_IMAGES).forEach(e=>{if(typeof e==="object"){o.add(e.desktop);o.add(e.mobile)}else{o.add(e)}});o.forEach(e=>{const o=new Image;o.src=e})};const applyBackgroundImage=(e,o)=>{const t=isMobileViewport();let n;if(o){n=o}else if(e===null){n=t?BACKGROUND_IMAGES.dark.mobile:BACKGROUND_IMAGES.fallback}else if(!isExcludedPage(location.pathname)&&e){n=t?BACKGROUND_IMAGES[e].mobile:BACKGROUND_IMAGES[e].desktop}else{n=t?BACKGROUND_IMAGES.dark.mobile:BACKGROUND_IMAGES.fallback}backgroundContainer.style.backgroundImage=`url(${n})`};const getUserColorScheme=()=>{const e=document.documentElement.getAttribute("data-user-color-scheme");return e==="dark"?"dark":"light"};const handleColorSchemeToggle=()=>{const e=getUserColorScheme();if(!isExcludedPage(location.pathname)){applyBackgroundImage(e)}removeBannerMask()};let resizeTimer;const handleViewportResize=()=>{clearTimeout(resizeTimer);resizeTimer=setTimeout(()=>{applyBackgroundImage(getUserColorScheme())},200)};const observeColorSchemeChange=()=>{const e=document.documentElement;const o={attributes:true,attributeFilter:["data-user-color-scheme"]};const t=e=>{for(const o of e){if(o.type==="attributes"&&o.attributeName==="data-user-color-scheme"){handleColorSchemeToggle()}}};const n=new MutationObserver(t);n.observe(e,o)};const initializeBackgrounds=()=>{preloadBackgroundImages();const e=location.pathname;const o=getUserColorScheme();if(PAGE_EXCLUSIONS.includes(e)){applyBackgroundImage(null)}else{applyBackgroundImage(o)}removeBannerMask()};if(!colorToggleButton){console.warn("未找到颜色模式切换按钮")}observeColorSchemeChange();window.addEventListener("resize",handleViewportResize,{passive:true});window.addEventListener("DOMContentLoaded",()=>{console.log("DOM 完成，开始初始化背景图。");initializeBackgrounds()});window.addEventListener("load",()=>{console.clear()});